<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CSV Parsing Test - Mountain State Miles</title>
</head>
<body>
  <h1>CSV Parsing Test</h1>
  
  <div>
    <h2>Test Time Parsing</h2>
    <button onclick="testTimeParsing()">Test Time Parsing</button>
    <div id="time-results"></div>
  </div>
  
  <div>
    <h2>Test CSV Parsing</h2>
    <input type="file" id="csv-file" accept=".csv" />
    <button onclick="testCSVParsing()">Test CSV Parsing</button>
    <div id="csv-results"></div>
  </div>

  <!-- Supabase Client Library -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <!-- Supabase Configuration -->
  <script src="supabase-config.js"></script>
  <!-- Supabase Helpers -->
  <script src="supabase-helpers.js"></script>
  
  <script>
    function testTimeParsing() {
      const testCases = [
        '18:30.45',
        '20:15.20', 
        '19:45.10',
        '21:30.15',
        '20:00.30',
        '22:00.70',
        '21:40.00',
        '23:00.50',
        '22:10.20',
        '24:00.80'
      ];
      
      let results = '<h3>Time Parsing Results:</h3><ul>';
      testCases.forEach(timeStr => {
        const result = parseTimeToSeconds(timeStr);
        const isValid = !isNaN(result);
        results += `<li><strong>${timeStr}</strong> -> <span style="color: ${isValid ? 'green' : 'red'}">${result} seconds</span> ${isValid ? '✓' : '✗'}</li>`;
      });
      results += '</ul>';
      
      document.getElementById('time-results').innerHTML = results;
    }
    
    async function testCSVParsing() {
      const fileInput = document.getElementById('csv-file');
      if (!fileInput.files[0]) {
        alert('Please select a CSV file first');
        return;
      }
      
      try {
        const file = fileInput.files[0];
        const csvText = await readFileAsText(file);
        
        const headers = getCSVTemplateHeaders();
        const csvData = parseCSV(csvText, headers);
        
        let results = '<h3>CSV Parsing Results:</h3>';
        results += `<p><strong>Total rows parsed:</strong> ${csvData.length}</p>`;
        results += `<p><strong>Note:</strong> Header row is automatically skipped</p>`;
        
        if (csvData.length > 0) {
          results += '<table border="1" style="border-collapse: collapse; margin-top: 10px;">';
          results += '<tr><th>Row</th><th>Athlete</th><th>Time (Original)</th><th>Time (Parsed)</th><th>Valid</th></tr>';
          
          csvData.forEach((row, index) => {
            const originalTime = row.time;
            const parsedTime = parseTimeToSeconds(originalTime);
            const isValid = !isNaN(parsedTime);
            
            results += `<tr style="background-color: ${isValid ? '#d4edda' : '#f8d7da'}">`;
            results += `<td>${index + 1}</td>`;
            results += `<td>${row.athlete_name}</td>`;
            results += `<td>${originalTime}</td>`;
            results += `<td>${parsedTime}</td>`;
            results += `<td>${isValid ? '✓' : '✗'}</td>`;
            results += '</tr>';
          });
          
          results += '</table>';
        } else {
          results += '<p style="color: red;">No data rows found. Check your CSV format.</p>';
        }
        
        document.getElementById('csv-results').innerHTML = results;
        
      } catch (error) {
        document.getElementById('csv-results').innerHTML = `<p style="color: red;">Error: ${error.message}</p>`;
      }
    }
    
    function readFileAsText(file) {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = e => resolve(e.target.result);
        reader.onerror = e => reject(e);
        reader.readAsText(file);
      });
    }
  </script>
</body>
</html>
